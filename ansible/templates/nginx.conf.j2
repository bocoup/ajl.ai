upstream api {
  server localhost:{{env_vars.HTTP_PORT}};
}

server {
  listen 80;
  server_name {{fqdn}};
  root {{public_path}};
  index index.html;
  error_page 404 /404.html;
  location / {
    try_files $uri /index.html;
  }
  location /api {
    include proxy_params;
    proxy_pass http://api;
    proxy_read_timeout 300s;
  }
}

{% if env == 'production' %}
server {
  listen 80 default_server;
  server_name _;
  return 301 https://{{fqdn}}$request_uri;
}
{% endif %}
